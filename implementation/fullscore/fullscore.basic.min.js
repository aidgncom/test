/*! GPL-3.0-or-later Â©Aidgn */const BEAT={RES:100,SRF:{S:"!",T:"~",P:"^",A:"*",F:"/",V:":"},MAP:{S:{},A:{}}};const RHYTHM={HIT:"/rhythm",ECO:["/rhythm/echo"],RES:100,TAP:3,THR:1,AGE:"259200",MAX:7,CAP:3500,DEL:1,REF:{}};class Beat{constructor(){this.t=[],this.b={},this.i={h:{...BEAT.MAP.S},a:{...BEAT.MAP.A}},this.o=Date.now()}m(t){if(this.d(),this.i.h[t])return this.t.push(BEAT.SRF.S+this.i.h[t]);let i=5381;for(let c=0;c<t.length;c++)i=(i<<5)+i+t.charCodeAt(c);const s=t.length<=7?3:t.length<=14?4:5;let h="",e=Math.abs(i);for(let c=0;c<s;c++)h+="0123456789abcdefghijklmnopqrstuvwxyz"[e%36],e=Math.floor(e/36);let o=BEAT.SRF.S+h,n="";for(;this.b[o]&&this.b[o]!==t;)n+='-',o=BEAT.SRF.S+n+h;this.b[o]=t,this.t.push(o)}d(){const t=Date.now(),i=(t-this.o)/BEAT.RES|0;i>0&&(this.t.push(BEAT.SRF.T+i),this.o=t)}a(t){if(!t||3===t.nodeType&&!(t=t.parentElement))return;this.d();let i=t.id&&this.i.a["#"+t.id]?"#"+t.id:null;!i&&"string"==typeof t.className&&t.className&&(i=t.className.trim().split(/\s+/).map(t=>"."+t).find(t=>this.i.a[t]));const s=!i&&"A"===t.tagName&&t.href&&t.getAttribute("href");if(s&&this.i.a[s]&&(i=s),i)return this.r(BEAT.SRF.A+this.i.a[i]);let h=0,e=t;for(;e&&e!==document.body;)h++,e=e.parentElement;const o=t.tagName.toLowerCase();let n=1,c=t.previousElementSibling;for(;c;)c.tagName.toLowerCase()===o&&n++,c=c.previousElementSibling;const a=h+o+n;this.r(BEAT.SRF.A+(this.i.a["*"+a]||a))}r(t){const i=this.t.length;if(i>1&&this.t[i-1].startsWith(BEAT.SRF.T)){const s=this.t[i-1].substring(1),h=this.t[i-2];if(h.endsWith(t))return this.t[i-2]=h.substring(0,h.length-t.length)+BEAT.SRF.F+s+t,void this.t.pop()}this.t.push(t)}x(){return this.t.join("")}}class Rhythm{constructor(){this.l="; Path=/; Max-Age="+RHYTHM.AGE+"; SameSite=Lax"+("https:"===location.protocol?"; Secure":"");const t=()=>{let t="";for(let i=0;i<8;i++)t+="0123456789abcdefghijklmnopqrstuvwxyz"[36*Math.random()|0];document.cookie="movement=0000000000_"+Math.floor(Date.now()/RHYTHM.RES)+"_"+t+"___; Path=/; SameSite=Lax"+("https:"===location.protocol?"; Secure":"")};this.g("movement")||(this.u(),this._(),t()),this.q(),document.addEventListener("click",t=>this.c(t.target),{capture:!0}),this.z=!1,document.addEventListener("scroll",()=>{this.n||this.q(),this.z||(this.z=!0,this.n.v++,this.w()),clearTimeout(this.s),this.s=setTimeout(()=>this.z=!1,150)},{capture:!0,passive:!0}),document.addEventListener("visibilitychange",()=>{const i=this.g(window.name),s=/mobi|android|tablet|ipad|iphone/i.test(navigator.userAgent);"hidden"===document.visibilityState?(s&&i&&"0"===i[0]&&(document.cookie=window.name+"=1"+i.slice(1)+this.l),setTimeout(()=>!/rhythm_\d+=0/.test(document.cookie)&&this.f&&this._(!0),1)):(s&&i&&"1"===i[0]&&(document.cookie=window.name+"=0"+i.slice(1)+this.l),!this.g("movement")&&(t(),this.q(!0)),this.p.o=Date.now())});const i=()=>{const t=this.g(window.name);t&&"0"===t[0]&&(document.cookie=window.name+"=1"+t.slice(1)+this.l)};window.addEventListener("blur",()=>"hidden"===document.visibilityState&&(i(),this.f=!0,setTimeout(()=>this.f=!1,17))),window.addEventListener("pagehide",t=>!t.persisted&&(i(),setTimeout(()=>!/rhythm_\d+=0/.test(document.cookie)&&this._(!0),1)))}g(t){const i="; "+document.cookie+";",s=i.indexOf("; "+t+"=");return s<0?null:i.slice(s+t.length+3,i.indexOf(";",s+t.length+3))}u(){for(let t,i=1;i<=RHYTHM.MAX;i++)t="rhythm_"+i,"2"===this.g(t)?.[0]&&(document.cookie=t+"=; Max-Age=0; Path=/");this.n=null,this.p=null,window.name=""}_(t=!1){t&&(document.cookie="movement=; Max-Age=0; Path=/; SameSite=Lax"+("https:"===location.protocol?"; Secure":""));const i=document.cookie.match(/rhythm_\d+=[^;]*/g);if(i){const t=[];for(let s=0;s<i.length;s++){const h=i[s].replace(/=./,"=2"),e=h.split("=")[0];+((this.g(e)||h).split("_")[6]||0)<RHYTHM.DEL?document.cookie=e+"=; Max-Age=0; Path=/":(document.cookie=h+this.l,t.push(h))}if(t.length)for(const i of RHYTHM.ECO)navigator.sendBeacon("h"===i[0]?i:location.origin+i,t.join(""));this.u()}}q(t=!1){this.movement=this.g("movement");const i=this.movement.split("_");if(this.h=+i[1],this.y=i[2],!t&&window.name.startsWith("rhythm_")){const t=this.g(window.name);if(t){const i=t.split("_"),s=i.slice(8).join("_");return this.n={m:window.name,h:+i[1],y:i[2],d:+i[3],r:+i[4],v:+i[5],k:+i[6]},this.p=new Beat,s&&(this.p.t=[s],this.p.o=Date.now()),this.p.m(location.pathname),this.w()}window.name=""}let s=null;for(let c=1;c<=RHYTHM.MAX;c++)if(!this.g("rhythm_"+c)){s="rhythm_"+c;break}if(!s){this._(),this.n=null;const t=Math.floor(Date.now()/RHYTHM.RES);this.movement=this.movement.split("_")[0]+"_"+t+"_"+this.y+"___",document.cookie="movement="+this.movement+"; Path=/; SameSite=Lax"+("https:"===location.protocol?"; Secure":""),this.h=t,s="rhythm_1"}window.name=s;const h=navigator.userAgent,e=document.referrer,o=e?.match(/^https?:\/\/([^\/]+)/)?.[1]||"";let n=e?o===location.hostname?1:2:0;if(2===n&&o)for(const c in RHYTHM.REF)if(o===c||o.endsWith("."+c)){n=RHYTHM.REF[c];break}this.n={m:s,h:this.h,y:this.y,d:/ipad|tablet|silk/i.test(h)||/android/i.test(h)&&!/mobi/i.test(h)?2:/mobi|iphone/i.test(h)?1:0,r:n,v:0,k:0},this.p=new Beat,this.p.m(location.pathname),this.w(!0)}w(t=!1){const i=this.g("movement")||this.movement;if(!t&&+i.split("_",2)[1]!==+this.movement.split("_",2)[1])return this.movement=i,this.n=null,void this.q(!0);const s=window.name.slice(7),h=i.split("___"),e=h[1]||"";if(!e.endsWith("~"+s)&&e!==s){document.cookie="movement="+h[0]+"___"+(e?e+"~":"")+s+"; Path=/; SameSite=Lax"+("https:"===location.protocol?"; Secure":"");const t=e.split("~").pop();if(t&&t!==s){const i=this.g("rhythm_"+t);i&&(document.cookie="rhythm_"+t+"="+i+"@---"+s+this.l)}}const o=this.g(window.name);if(o){const t=o.split("_").slice(8).join("_");if(t.match(/@---\d+$/)){const i=this.p.x();let s=0;for(;s<t.length&&t[s]===i[s];)s++;this.p.t=[t+i.slice(s).replace(/^\/+/,BEAT.SRF.T)]}}const n=[0,this.n.h,this.n.y,this.n.d,this.n.r,this.n.v,this.n.k,Math.floor(Date.now()/RHYTHM.RES)-this.n.h,this.p?.x()||""].join("_");document.cookie=this.n.m+"="+n+this.l,n.length>RHYTHM.CAP&&(document.cookie=this.n.m+"=1"+n.slice(1)+this.l,this.q(!0))}c(t){this.n||this.q(),this.n.k++,this.p.a(t),this.w();const i=this.g("movement"),s=i?.split("_")[0],h=this.g("waf"),e=this.movement?.split("_")[0];s&&s!==e&&(this.movement=i,this.j=RHYTHM.TAP);const o=s?.[0];o&&o<="2"&&o>(h||"0")&&(document.cookie="waf="+o+"; Path=/",location.reload());for(let n=1;s&&n<10;n++)"1"===s[n]&&RHYTHM.HUM?.[n]?.(this);if(this.n.k%RHYTHM.TAP===0||this.j){const t=new AbortController;fetch(location.origin+("/"===RHYTHM.HIT?"":RHYTHM.HIT)+"/?livestreaming",{method:"HEAD",signal:t.signal,credentials:"include",redirect:"manual",keepalive:!0}).catch(()=>{}),this.n.k>RHYTHM.TAP&&!this.j&&setTimeout(()=>t.abort(),RHYTHM.THR),this.j&&this.j--}}}document.addEventListener("DOMContentLoaded",()=>new Rhythm);